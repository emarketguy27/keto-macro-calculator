document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("ketoForm");let t=null,n=[],o=[];function a(){const e=document.getElementById("chart");if(!e)return console.error("Chart container not found"),!1;const t=e.getBoundingClientRect();return 20===t.width||20===t.height?(console.warn("Chart container has zero dimensions",t),!1):"undefined"==typeof ApexCharts?(console.error("ApexCharts not loaded"),!1):(console.log("Chart rendering environment OK"),!0)}function r(e){const t=e.querySelector(".chart-slider-container"),n=e.querySelector(".chart-slider"),o=e.querySelector(".slider-dots"),a=n.children;function r(){const e=t.scrollLeft+t.clientWidth/2;Array.from(a).forEach(((t,n)=>{const a=o.children[n],r=t.offsetLeft,l=r+t.offsetWidth;a.classList.toggle("active",e>=r&&e<=l)}))}o.innerHTML="",Array.from(a).forEach(((e,n)=>{const r=document.createElement("div");r.className="slider-dot",0===n&&r.classList.add("active"),r.addEventListener("click",(()=>{!function(e){t.scrollTo({left:a[e].offsetLeft,behavior:"smooth"})}(n)})),o.appendChild(r)})),t.addEventListener("scroll",r),e.querySelectorAll(".slider-nav").forEach((e=>{e.addEventListener("click",(()=>{setTimeout(r,300)}))}))}e.addEventListener("submit",(function(e){e.preventDefault();const a=document.querySelector('input[name="unitSystem"]:checked').value,l={gender:document.getElementById("gender").value,age:parseInt(document.getElementById("age").value),weight:parseFloat(document.getElementById("weight").value),height:parseFloat(document.getElementById("height").value),bodyFat:parseFloat(document.getElementById("bodyFat").value),activityLevel:document.getElementById("activity_level").value,goal:document.getElementById("goal").value,carbsChoice:parseFloat(document.getElementById("net_carbs").value)||7.5,unitSystem:a};isNaN(l.age)||isNaN(l.weight)||isNaN(l.height)||isNaN(l.bodyFat)||isNaN(l.carbsChoice)?alert("Please fill in all required fields with valid numbers"):("us_customary"===l.unitSystem&&(l.weight=.453592*l.weight,l.height=2.54*l.height),function(e){const{gender:a,age:l,weight:i,height:s,bodyFat:c,activityLevel:d,goal:m,carbsChoice:u}=e;let h;if(c&&!isNaN(c)){h=370+21.6*(i*(1-c/100))}else h="male"===a?10*i+6.25*s-5*l+5:10*i+6.25*s-5*l-161;let g=h;const y={sedentary:1.2,light:1.375,active:1.55,very_active:1.725};let p=h*y[d],f=p*(u/100),E=.15*p,v=p-(f+E),C=g*y[d],b=E/C*100,B=v/C*100,I=u,w=p;console.log("Fat%, Protein%, Carbs% = "+B,b,I),console.log("Base Maintenance Calories: "+w);let F={};"lose"===m?F={small:.9*p,moderate:.8*p,large:.7*p,displayCalories:F.moderate}:"gain"===m&&(C+=500);document.getElementById("bmrValue").textContent=Math.round(h),document.getElementById("caloriesToConsume").textContent=Math.round(w);(function(e,n,o,a){const r=Math.round(n),l=Math.round(o),i=Math.round(a);chartLabels=[`Fat: ${r} kCal`,`Protein: ${l} kCal`,`Carbs: ${i} kCal`];const s={chart:{width:500,type:"pie",animations:{enabled:!0,easing:"easeout",speed:800},dropShadow:{enabled:!0,top:0,left:0,blur:6,color:"#000",opacity:.4},redrawOnParentResize:!0,redrawOnWindowResize:!0},legend:{position:"bottom"},series:e,labels:chartLabels,colors:["#FF6384","#36A2EB","#FFCE56"],tooltip:{enabled:!0,y:{formatter:function(e){return`${Math.round(e)}%`}}},responsive:[{breakpoint:768,options:{chart:{width:240,height:450},legend:{position:"bottom",top:310,horizontalAlign:"center",onItemHover:{highlightDataSeries:!0}}}}]};t?t.updateOptions(s):setTimeout((()=>{try{t=new ApexCharts(document.getElementById("chart"),s),t.render()}catch(e){console.error("Chart initialization failed:",e)}}),50)})([v/p*100,E/p*100,Number(u)],v,E,f),function(e,t,a,l){const i=document.getElementById("calorieDeficitCharts"),s=document.getElementById("calorieSurplusChart");if("lose"===e)i.style.display="flex",s.style.display="none",function(e,t){n.length&&(n.forEach((e=>e.destroy())),n=[]);const o=document.getElementById("calorieDeficitCharts"),a=o.querySelector(".chart-slider");if(!o||!a)return void console.error("Slider elements not found!");a.innerHTML="";const l=t?.carbPercent||12.5,i=.7,s=.175,c=e=>{const t=Math.round(e*i/9),n=Math.round(e*s/4),o=Math.round(9*t),a=Math.round(4*n),r=Math.round(4*l);return{fat:{grams:t,calories:o},protein:{grams:n,calories:a},carbs:{grams:l,calories:r},totalCalories:Math.round(e)}},d=[{title:"Small Deficit (10%)",calories:e.small},{title:"Moderate Deficit (20%)",calories:e.moderate},{title:"Large Deficit (30%)",calories:e.large}];d.forEach((e=>{const t=c(e.calories),o=document.createElement("div");o.className="deficit-chart-slide",a.appendChild(o);const r=document.createElement("h3");r.textContent=`${e.title} • ${t.totalCalories} kcal`,o.appendChild(r),setTimeout((()=>{try{const e=new ApexCharts(o,{chart:{type:"pie",height:400,width:"100%",animations:{enabled:!0}},series:[t.fat.grams,t.protein.grams,t.carbs.grams],labels:[`Fat: ${t.fat.grams}g (${t.fat.calories} kcal)`,`Protein: ${t.protein.grams}g (${t.protein.calories} kcal)`,`Carbs: ${t.carbs.grams}g (${t.carbs.calories} kcal)`],colors:["#FF6384","#36A2EB","#FFCE56"],tooltip:{y:{formatter:e=>`${e}g`}}});e.render(),n.push(e)}catch(e){console.error("Chart rendering failed:",e)}}),50)})),r(document.getElementById("calorieDeficitCharts"))}(t,a);else if("gain"===e){i.style.display="none",s.style.display="flex";!function(e,t){o=o||[],o.forEach((e=>{try{e.destroy()}catch(e){console.warn(e)}})),o=[];const n=document.getElementById("calorieSurplusChart").querySelector(".chart-slider");n.innerHTML="";const a=t?.carbPercent||12.5,l=.7,i=.175,s=e=>{const t=Math.round(e*l/9),n=Math.round(e*i/4),o=Math.round(9*t),r=Math.round(4*n),s=Math.round(4*a);return{fat:{grams:t,calories:o},protein:{grams:n,calories:r},carbs:{grams:a,calories:s},totalCalories:Math.round(e)}},c=[{title:"Small Surplus (+250 kcal)",calories:e.small},{title:"Moderate Surplus (+500 kcal)",calories:e.moderate},{title:"Large Surplus (+750 kcal)",calories:e.large}];c.forEach((e=>{const t=s(e.calories),a=document.createElement("div");a.className="surplus-chart-slide",n.appendChild(a);const r=document.createElement("h3");r.textContent=`${e.title} • ${t.totalCalories} kcal`,a.appendChild(r),setTimeout((()=>{try{const e=new ApexCharts(a,{chart:{type:"pie",height:400,width:"100%",animations:{enabled:!0}},series:[t.fat.grams,t.protein.grams,t.carbs.grams],labels:[`Fat: ${t.fat.grams}g (${t.fat.calories} kcal)`,`Protein: ${t.protein.grams}g (${t.protein.calories} kcal)`,`Carbs: ${t.carbs.grams}g (${t.carbs.calories} kcal)`],colors:["#FF6384","#36A2EB","#FFCE56"],tooltip:{y:{formatter:e=>`${e}g`}}});e.render(),o.push(e)}catch(e){console.error("Chart rendering failed:",e)}}),50)})),r(document.getElementById("calorieSurplusChart"))}({small:l+250,moderate:l+500,large:l+750},a)}else i.style.display="none",s.style.display="none"}(m,F,e,p)}(l),console.log("Form values:",l),document.getElementById("summaryAge").textContent=document.getElementById("age").value,document.getElementById("summaryActivity").textContent=document.getElementById("activity_level").options[document.getElementById("activity_level").selectedIndex].text,document.getElementById("summaryGender").textContent="male"===document.getElementById("gender").value?"male":"female",document.getElementById("summaryHeight").textContent=document.getElementById("height").value+" "+document.getElementById("heightUnit").textContent,document.getElementById("summaryWeight").textContent=document.getElementById("weight").value+" "+document.getElementById("weightUnit").textContent,document.getElementById("summaryBodyFat").textContent=document.getElementById("bodyFat").value,setTimeout((()=>{const e=document.getElementById("ketoResults");e&&(e.scrollIntoView({behavior:"smooth",block:"start"}),e.style="visibility: visible; opacity: 1",e.setAttribute("tabindex","-1"),e.focus())}),300))})),a()||(console.warn("Chart rendering conditions not met - delaying initialization"),setTimeout((()=>{a()&&initializeCharts()}),500)),document.querySelectorAll(".slider-nav").forEach((e=>{e.addEventListener("click",(t=>{const n=e.closest(".chart-slider-wrapper").querySelector(".chart-slider-container"),o=.8*n.clientWidth;n.scrollBy({left:e.classList.contains("prev")?-o:o,behavior:"smooth"}),setTimeout((()=>{e.closest(".chart-slider-wrapper").querySelector(".slider-dots").dispatchEvent(new Event("scroll"))}),300)}))}))})),jQuery(document).ready((function(e){function t(){var t=e('input[name="unitSystem"]:checked').val();console.log("Selected unit system:",t),"metric"===t?(e("#weightUnit").text("kg"),e("#heightUnit").text("cm")):"us_customary"===t&&(e("#weightUnit").text("lbs"),e("#heightUnit").text("inches"))}t(),e('input[name="unitSystem"]').on("change",t),e("#ketoForm").on("submit",(function(t){t.preventDefault(),e("html, body").animate({scrollTop:e("#ketoResults").offset().top-20},800)}))}));