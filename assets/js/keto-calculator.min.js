function initSliderDots(e){let o=e.querySelector(".chart-slider-container");var t=e.querySelector(".chart-slider");let n=e.querySelector(".slider-dots"),l=t.children;function a(){let r=o.scrollLeft+o.clientWidth/2;Array.from(l).forEach((e,t)=>{var t=n.children[t],a=e.offsetLeft,e=a+e.offsetWidth;t.classList.toggle("active",r>=a&&r<=e)})}n.innerHTML="",Array.from(l).forEach((e,t)=>{var a=document.createElement("div");a.className="slider-dot",0===t&&a.classList.add("active"),a.addEventListener("click",()=>{var e;e=t,o.scrollTo({left:l[e].offsetLeft,behavior:"smooth"})}),n.appendChild(a)}),o.addEventListener("scroll",a),e.querySelectorAll(".slider-nav").forEach(e=>{e.addEventListener("click",()=>{setTimeout(a,300)})})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("ketoForm");let N=null,D=[],T=[];function t(){var e=document.getElementById("chart");if(e){e=e.getBoundingClientRect();if(20===e.width||20===e.height)console.warn("Chart container has zero dimensions",e);else{if("undefined"!=typeof ApexCharts)return console.log("Chart rendering environment OK"),1;console.error("ApexCharts not loaded")}}else console.error("Chart container not found")}e.addEventListener("submit",function(e){e.preventDefault();e=document.querySelector('input[name="unitSystem"]:checked').value,e={gender:document.getElementById("gender").value,age:parseInt(document.getElementById("age").value),weight:parseFloat(document.getElementById("weight").value),height:parseFloat(document.getElementById("height").value),bodyFat:parseFloat(document.getElementById("bodyFat").value),activityLevel:document.getElementById("activity_level").value,goal:document.getElementById("goal").value,carbsChoice:parseFloat(document.getElementById("net_carbs").value)||7.5,unitSystem:e};isNaN(e.age)||isNaN(e.weight)||isNaN(e.height)||isNaN(e.bodyFat)||isNaN(e.carbsChoice)?alert("Please fill in all required fields with valid numbers"):("us_customary"===e.unitSystem&&(e.weight=.453592*e.weight,e.height=2.54*e.height),(a=>{let{gender:e,age:t,weight:r,height:o,bodyFat:n,activityLevel:l,goal:i,carbsChoice:s}=a,c,d=c=n&&!isNaN(n)?370+21.6*(B=r*(1-n/100)):"male"===e?10*r+6.25*o-5*t+5:10*r+6.25*o-5*t-161,m={sedentary:1.2,light:1.375,active:1.55,very_active:1.725},u=c*m[l],h=u*(s/100),g=.15*u,y=u-(h+g),p=d*m[l],v=g/p*100,f=y/p*100,E=s,C=u,b=(console.log("Fat%, Protein%, Carbs% = "+f,v,E),console.log("Base Maintenance Calories: "+C),{});"lose"===i?b={small:.9*u,moderate:.8*u,large:.7*u,displayCalories:b.moderate}:"gain"===i&&(p+=500),document.getElementById("bmrValue").textContent=Math.round(c),document.getElementById("caloriesToConsume").textContent=Math.round(C);var B=[y/u*100,g/u*100,Number(s)];{var I=B,w=y,S=g,F=h;let e=Math.round(w),t=Math.round(S),a=Math.round(F),r=(chartLabels=[`Fat: ${e} kCal`,`Protein: ${t} kCal`,`Carbs: ${a} kCal`],{chart:{width:500,type:"pie",animations:{enabled:!0,easing:"easeout",speed:800},dropShadow:{enabled:!0,top:0,left:0,blur:6,color:"#000",opacity:.4},redrawOnParentResize:!0,redrawOnWindowResize:!0},legend:{position:"bottom"},series:I,labels:chartLabels,colors:["#FF6384","#36A2EB","#FFCE56"],tooltip:{enabled:!0,y:{formatter:function(e){return Math.round(e)+"%"}}},responsive:[{breakpoint:768,options:{chart:{width:240,height:450},legend:{position:"bottom",top:310,horizontalAlign:"center",onItemHover:{highlightDataSeries:!0}}}}]});N?N.updateOptions(r):setTimeout(()=>{try{(N=new ApexCharts(document.getElementById("chart"),r)).render()}catch(e){console.error("Chart initialization failed:",e)}},50)}var k=i,x=b,M=u,L=document.getElementById("calorieDeficitCharts"),$=document.getElementById("calorieSurplusChart");if("lose"===k){L.style.display="flex",$.style.display="none";{var A=a;D.length&&(D.forEach(e=>e.destroy()),D=[]);let e=document.getElementById("calorieDeficitCharts"),d=e.querySelector(".chart-slider");if(e&&d){d.innerHTML="";let c=A?.carbPercent||12.5;[{title:"Small Deficit (10%)",calories:x.small},{title:"Moderate Deficit (20%)",calories:x.moderate},{title:"Large Deficit (30%)",calories:x.large}].forEach(e=>{a=e.calories,s=Math.round(.7*a/9),r=Math.round(.175*a/4),o=Math.round(9*s),n=Math.round(4*r),l=Math.round(4*c);let t={fat:{grams:s,calories:o},protein:{grams:r,calories:n},carbs:{grams:c,calories:l},totalCalories:Math.round(a)};var a,r,o,n,l;let i=document.createElement("div");i.className="deficit-chart-slide",d.appendChild(i);var s=document.createElement("h3");s.textContent=`${e.title} • ${t.totalCalories} kcal`,i.appendChild(s),setTimeout(()=>{try{var e=new ApexCharts(i,{chart:{type:"pie",height:400,width:"100%",animations:{enabled:!0}},series:[t.fat.grams,t.protein.grams,t.carbs.grams],labels:[`Fat: ${t.fat.grams}g (${t.fat.calories} kcal)`,`Protein: ${t.protein.grams}g (${t.protein.calories} kcal)`,`Carbs: ${t.carbs.grams}g (${t.carbs.calories} kcal)`],colors:["#FF6384","#36A2EB","#FFCE56"],tooltip:{y:{formatter:e=>e+"g"}}});e.render(),D.push(e)}catch(e){console.error("Chart rendering failed:",e)}},50)}),initSliderDots(document.getElementById("calorieDeficitCharts"))}else console.error("Slider elements not found!")}}else if("gain"!==k)L.style.display="none",$.style.display="none";else{L.style.display="none",$.style.display="flex";{x={small:M+250,moderate:M+500,large:M+750},k=a;(T=T||[]).forEach(e=>{try{e.destroy()}catch(e){console.warn(e)}}),T=[];let e=document.getElementById("calorieSurplusChart"),c=e.querySelector(".chart-slider"),d=(c.innerHTML="",k?.carbPercent||12.5),t=[{title:"Small Surplus (+250 kcal)",calories:x.small},{title:"Moderate Surplus (+500 kcal)",calories:x.moderate},{title:"Large Surplus (+750 kcal)",calories:x.large}];t.forEach(e=>{a=e.calories,s=Math.round(.7*a/9),r=Math.round(.175*a/4),o=Math.round(9*s),n=Math.round(4*r),l=Math.round(4*d);let t={fat:{grams:s,calories:o},protein:{grams:r,calories:n},carbs:{grams:d,calories:l},totalCalories:Math.round(a)};var a,r,o,n,l;let i=document.createElement("div");i.className="surplus-chart-slide",c.appendChild(i);var s=document.createElement("h3");s.textContent=`${e.title} • ${t.totalCalories} kcal`,i.appendChild(s),setTimeout(()=>{try{var e=new ApexCharts(i,{chart:{type:"pie",height:400,width:"100%",animations:{enabled:!0}},series:[t.fat.grams,t.protein.grams,t.carbs.grams],labels:[`Fat: ${t.fat.grams}g (${t.fat.calories} kcal)`,`Protein: ${t.protein.grams}g (${t.protein.calories} kcal)`,`Carbs: ${t.carbs.grams}g (${t.carbs.calories} kcal)`],colors:["#FF6384","#36A2EB","#FFCE56"],tooltip:{y:{formatter:e=>e+"g"}}});e.render(),T.push(e)}catch(e){console.error("Chart rendering failed:",e)}},50)}),initSliderDots(document.getElementById("calorieSurplusChart"))}}})(e),console.log("Form values:",e),document.getElementById("summaryAge").textContent=document.getElementById("age").value,document.getElementById("summaryActivity").textContent=document.getElementById("activity_level").options[document.getElementById("activity_level").selectedIndex].text,document.getElementById("summaryGender").textContent="male"===document.getElementById("gender").value?"male":"female",document.getElementById("summaryHeight").textContent=document.getElementById("height").value+" "+document.getElementById("heightUnit").textContent,document.getElementById("summaryWeight").textContent=document.getElementById("weight").value+" "+document.getElementById("weightUnit").textContent,document.getElementById("summaryBodyFat").textContent=document.getElementById("bodyFat").value,setTimeout(()=>{var e=document.getElementById("ketoResults");e&&(e.scrollIntoView({behavior:"smooth",block:"start"}),e.style="visibility: visible; opacity: 1",e.setAttribute("tabindex","-1"),e.focus())},300))}),t()||(console.warn("Chart rendering conditions not met - delaying initialization"),setTimeout(()=>{t()&&initializeCharts()},500))}),document.querySelectorAll(".slider-nav").forEach(r=>{r.addEventListener("click",e=>{var t=r.closest(".chart-slider-wrapper").querySelector(".chart-slider-container"),a=.8*t.clientWidth;t.scrollBy({left:r.classList.contains("prev")?-a:a,behavior:"smooth"}),setTimeout(()=>{r.closest(".chart-slider-wrapper").querySelector(".slider-dots").dispatchEvent(new Event("scroll"))},300)})}),jQuery(document).ready(function(t){function e(){var e=t('input[name="unitSystem"]:checked').val();console.log("Selected unit system:",e),"metric"===e?(t("#weightUnit").text("kg"),t("#heightUnit").text("cm")):"us_customary"===e&&(t("#weightUnit").text("lbs"),t("#heightUnit").text("inches"))}e(),t('input[name="unitSystem"]').on("change",e),t("#ketoForm").on("submit",function(e){e.preventDefault(),t("html, body").animate({scrollTop:t("#ketoResults").offset().top-20},800)})});